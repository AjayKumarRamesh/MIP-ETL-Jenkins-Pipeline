pipeline {
    agent { label 'kube_pod_slave' }
    stages {
        /*stage('GitHub Checkout') {
            git credentialsId: 'sangita_id_rsa' ,
            url: 'ssh://git@github.ibm.com/CIO-MAP/Jenkins_Poc_mapetl.git', branch: 'master'  
        }*/
        stage('Kickoff Jobs') {
            steps {
                script{
                    def builds = [:]
                    def names = "${JOB_NAMES}".split('\n')
                    
                    for (x in names) {
                        def name = x

                        builds[name] = {
                            build job: name, propagate: true, wait: true
                        }

                    }
                    parallel builds

                    def body_text = ''
                    for (name in names) {
                    def key = name
                    body_text += builds[key].getDisplayName() + " - Build # " + builds[key].getNumber + " - " + builds[key].getResult

                    if (builds[key].getResult == 'FAILURE') {
                        body_text += ": Check console output at " + builds[key].getAbsoluteUrl() + " to view the results.\n"
                    } else {
                        body_text += "\n"
                    }
                }
                emailext to: "caseyboerst@ibm.com",
                subject: "${env.JOB_BASE_NAME} - Build # ${env.BUILD_NUMBER} - ${currentBuild.currentResult}!",
                body: body_text

                }
            }
        }
    }
    /*post {
        always {
            script {
                def body_text = ''
                for (name in names) {
                    def key = name
                    body_text += builds[key].getDisplayName() + " - Build # " + builds[key].getNumber + " - " + builds[key].getResult

                    if (builds[key].getResult == 'FAILURE') {
                        body_text += ": Check console output at " + builds[key].getAbsoluteUrl() + " to view the results.\n"
                    } else {
                        body_text += "\n"
                    }
                }
            }
            emailext to: "caseyboerst@ibm.com",
            subject: "${env.JOB_BASE_NAME} - Build # ${env.BUILD_NUMBER} - ${currentBuild.currentResult}!",
            body: body_text
        }
    }*/
}